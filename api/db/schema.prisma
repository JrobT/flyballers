datasource db {
  provider  = "postgres"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

generator client {
  provider      = "prisma-client-js"
  binaryTargets = "native"
}

enum Class {
  FOUNDATION
  OPEN
}

enum Type {
  SINGLES
  TEAMS
}

model User {
  id        Int      @id @default(autoincrement())
  club      Club     @relation(fields: [clubId], references: [id])
  clubId    Int      @unique
  createdAt DateTime @default(now())
  email     String   @unique @db.VarChar(255)
  name      String?  @db.VarChar(255)
  photoUrl  String?
}

model Club {
  id      Int      @id @default(autoincrement())
  contact Contact?
  events  Event[]
  members User[]
  name    String   @db.VarChar(255)

  @@index([name])
}

model Contact {
  id     Int    @id @default(autoincrement())
  club   Club   @relation(fields: [clubId], references: [id])
  clubId Int    @unique
  email  String @unique @db.VarChar(255)
  name   String @db.VarChar(255)
}

model Event {
  id        Int        @id @default(autoincrement())
  club      Club       @relation(fields: [clubId], references: [id])
  clubId    Int
  eventDays EventDay[]
  name      String     @db.VarChar(255)

  @@index([clubId])
  @@index([name])
}

model EventDay {
  id       Int       @id @default(autoincrement())
  date     DateTime
  eventId  Int
  event    Event     @relation(fields: [eventId], references: [id], onDelete: Cascade)
  schedule Schedule?

  @@index([date])
  @@index([eventId])
}

model Schedule {
  id         Int      @id @default(autoincrement())
  eventDay   EventDay @relation(fields: [eventDayId], references: [id])
  eventDayId Int      @unique
  races      Race[]

  @@index([eventDayId])
}

model Race {
  id         Int      @id @default(autoincrement())
  class      Class
  division   Int      @db.SmallInt
  schedule   Schedule @relation(fields: [scheduleId], references: [id])
  scheduleId Int
  team1      String   @db.VarChar(255)
  team2      String   @db.VarChar(255)
  type       Type

  @@index([class])
  @@index([team1])
  @@index([team2])
  @@index([type])
}
